<html>
    <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta http-equiv="Cache-Control" content="no-cache">
      <meta name="viewport" content="initial-scale=1.0,maximum-scale=1.0,minimum-scale=1.0,user-scalable=no">
      <link href="https://fonts.googleapis.com/css?family=Ubuntu&display=swap" rel="stylesheet">
      <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.7.1/p5.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.7.1/addons/p5.dom.min.js"></script>      <script src=""></script>
      <title>Around Us</title>

    </head>
    <style>

      body{
        margin: 0;
        overflow: hidden;
        font-family: 'Ubuntu', sans-serif;
        /*background: linear-gradient(to right,  #000000, #ffffff, #000000); !* W3C, IE10+, FF16+, Chrome26+, Opera12+, Safari7+ *!*/
        /*background-size: 300% 100%;*/
        /*background-position: 125%;*/
        /*background-position: 105%;*/
          /*background-position: 145%;*/
        background: black;
          font-family: 'Helvetica Neue', sans-serif;
      }

      #timeline{
          position: fixed;
          color: white;
          margin-left: 64px;

      }

      .info{
          position: fixed;
          color: white;
          top: 40vh;
          left: 25vw;
      }

      #year{
          font-size: 36px;
      }

      #title{
          font-size: 42px;
      }

      #year-div, #title-div{
          margin-bottom: 18px;
          margin-left: 14px;
      }

      #title-div{
          position: fixed;
          color: white;
          top: calc(40vh - 58px);
          left: 20vw;
      }

      #civil-block, #gov-block, #com-block, #mil-block, #unknown-block{
          width: 18px;
          height: 5px;
          display: inline-block;
          margin-bottom: 3px;
          margin-right: 8px;
          margin-left: 8px;
      }

      #civil, #gov, #com, #mil, #unknown{
          width: 30px;
          display: inline-block;
          text-align: right;

          margin-bottom: 6px;
          margin-top: 0;
      }

      #civil-block{
          background: rgb(247, 194, 66);
      }

      #gov-block{
          background: rgb(224, 60, 138);
      }

      #com-block{
          background: rgb(88, 178, 220);
      }

      #mil-block{
          background: rgb(144, 180, 75);
      }

      #unknown-block{
          background: rgb(255, 255, 255);
      }

      #by-years{
          opacity: 0;
      }

      #cards-btn, #by-year-btn, #home-btn, #info-btn{
          z-index: 1;
      }


      #by-year-btn{
          transform: rotateZ(90deg);
          transform-origin: left;
          position: fixed;
          right: -56px;
          background-color: transparent;
          color: white;
          top: calc(50vh - 45px);
          transition: background-color 1s, color 1s;
      }

      #cards-btn{
          transform: rotateZ(-90deg);
          transform-origin: right;
          position: fixed;
          left: -63px;
          background-color: transparent;
          color: white;
          top: calc(50vh - 45px);
          transition: background-color 1s, color 1s;
      }

      #home-btn{
          position: fixed;
          right: calc(50vw - 45px);
          background-color: transparent;
          color: white;
          top: 16px;
          transition: background-color 1s, color 1s;
      }


      #info-btn{
          transform: rotateZ(180deg);

          position: fixed;
          right: calc(50vw - 45px);
          background-color: transparent;
          color: white;
          bottom: 16px;
          transition: background-color 1s, color 1s;
      }

        #by-year-btn-span, #cards-btn-span, #home-span, #info-btn-span{
            padding: 4px;
        }

      #by-year-btn:hover, #cards-btn-span:hover, #home-span:hover, #info-btn-span:hover{
          cursor: pointer;
          transition: background-color 1s, color 1s;
          background-color: white;
          color: black;
      }

      #top-line, #bottom-line, #right-line, #left-line{
          position: fixed;
          z-index: 1;
          background: white;
      }

      #right-line, #left-line{
          height: 100vh;
          width: 1px;
      }

      #top-line, #bottom-line{
          width: 100vw;
          height: 1px;
      }

      #right-line{
          right: 48px;
      }

      #left-line{
          left: 48px;
      }

      #top-line{
        top: 48px;
      }

      #bottom-line{
        bottom: 48px;
      }

      #info-panel{
          width: 40vw;
          position: fixed;
          top: 100vh;
          color: white;
          background: rgba(0, 0, 0, 0.5);
          padding: 12px 24px;
          border-radius: 12px;
          left: calc((100vw - 40vw - 48px) / 2);
          opacity: 0;
      }

      #map-cvs{
          position: fixed;
          top: 100vh;
          left: 0;
          opacity: 0;
      }

      #card{
        width: 35vw;
        height: 100vh;
        /*background: #0B1013;*/
        position: absolute;
        top: 0;
        right: 84px;
          display: none;
      }

      #map-info{
          opacity: 0;
      }

      #map-index{
          color: white;
          position: fixed;
          bottom: -56vh;
          transform: rotate(-90deg);
          left: 48vw;
      }

      #map-num{
          color: white;
          position: fixed;
          bottom: -63vh;
          transform: rotate(-90deg);
          left: 49vw;
      }

      #map-div{
          position: fixed;
          background: white;
          width: 1px;
          height: 80vw;
          bottom: -34.1vw;
          transform: rotate(-90deg);
          left: 86.5vh;
      }

      .map-list{
          transform: rotate(45deg);
          margin-bottom: 6px;
          font-size: 12px;
      }

      #card-img{
        margin: auto;
        display: block;
        margin-top: calc((100vh - 31.5vw) / 2);
      }

      a{
        color: white;
      }
    </style>
    <body>
      <div id="by-years">
          <div id="timeline"></div>
          <div class="info">
              <!--<div id="title-div"><span id="title">Around Us</span></div>-->
              <div id="year-div"><span id="year">1974</span></div>
              <div id="civil-div">
                  <p id="civil">0</p><div id="civil-block"></div><span>Civil</span>
              </div>
              <div id="gov-div">
                  <p id="gov">0</p><div id="gov-block"></div><span>Government</span>
              </div>
              <div id="com-div">
                  <p id="com">0</p><div id="com-block"></div><span>Commercial</span>
              </div>
              <div id="mil-div">
                  <p id="mil">0</p><div id="mil-block"></div><span>Military</span>
              </div>
              <div id="unknown-div">
                  <p id="unknown">0</p><div id="unknown-block"></div><span>????????</span>
              </div>
          </div>
      </div>
      <!--<div id="title-div"><span id="title">Around Us</span></div>-->
      <div id="menu">
          <div onclick="satByYears()" id="by-year-btn"><span id="by-year-btn-span">TIMELINE</span></div>
          <div onclick="viewCards()" id="cards-btn"><span id="cards-btn-span">SATELLITE</span></div>
          <div onclick="info()" id="home-btn"><span id="home-span">AROUND US</span></div>
          <div onclick="showmap()" id="info-btn"><span id="info-btn-span">WORLD MAP</span></div>

      </div>
      <div id="right-line"></div>
      <div id="bottom-line"></div>
      <div id="left-line"></div>
      <div id="top-line"></div>
      <canvas id="webgl"></canvas>
      <div id=card>
        <img width="60%" height="auto" id="card-img" src="data/img/cover.png">
      </div>
      <div id="info-panel">
          <p>How was your day?  Did you check the weather when you woke up?  You have a plan to go to a new restaurant, but you don't know how to get there.<br><br><i>What allows you to check the weather and find directions to a place?</i></p>
          <p>In spirit Lisa Park’s <i>Stuff You Can Kick: Toward a Theory of Media Infrastructures</i>, we are investigating the infrastructure of satellites launched in the year 2018 - 19. Satellites have become one of the most essential infrastructures that make distribution of media possible and like most media infrastructures, the extent of the structure is hard to be visually represented in one glance and no human can physically see the whole infrastructure. To add to this difficulty of visualizing infrastructures, satellites, once launched to the Earth’s orbit, are no longer visible to the human eye. Around Us raises awareness of these satellites that comprise an important infrastructure of digital media communications. This project also questions whether we have the full information about the number of satellites orbiting the Earth and what the use of those that are not public knowledge may be.</p>
          <p>Around Us is a project by <a target="_blank" href="https://expandingexperience.kr/">Jaekook Han</a> and <a target="_blank" href="http://jiwonshin.com/">Jiwon Shin</a>.</p>
          <p>Data from <a target="_blank" href="https://www.ucsusa.org/resources/satellite-database">Union of Concerned Scientists</a> and visualization created with <a target="_blank" href="https://threejs.org/">Three.js</a>.</p>
      </div>
      <div id="p5-cvs"></div>
      <div id="map-info">
          <div id="map-index"></div>
          <div id="map-div"></div>
          <div id="map-num"></div>
      </div>


      <script src="js/three.min.js"></script>
      <script src="js/three.interaction.js"></script>
      <script src="js/OrbitControls.js"></script>
      <script src="js/Detector.js"></script>
      <script src="js/ImprovedNoise.js"></script>
      <script src="js/Particle.js"></script>
      <script>

        let satdata = [];
        let satHeader = [];

        let satYears = [];
        let satYearCount = [];

        let maps = [];
        let countries = [
            "Algeria", "Argentina", "Australia", "Austria", "Azerbaijan", "Bangladesh", "Belarus", "Belgium", "Bhutan", "Bolivia", "Brazil", "Bulgaria", "Canada", "Chile", "China_Brazil", "China_France", "China_Italy", "China", "Colombia", "Czech-Republic", "Denmark", "Egypt", "ESA_USA_Russia", "ESA_USA", "ESA", "Finland", "France_Belgium_Sweden", "France_Israel", "France_Italy_Belgium_Spain_Greece", "France_Italy", "France_USA", "France", "Germany", "Greece_United-Kingdom", "Greece", "India_Canada", "India_France", "India", "Indonesia", "Iran", "Iraq", "Israel", "Italy", "Japan_Singapore", "Japan", "Jordan", "Kazakhstan", "Laos", "Latvia", "Lithuania", "Luxembourg", "Malaysia", "Mexico", "Mongolia", "Morocco_Germany", "Morocco", "Netherlands", "Nigeria", "Norway", "Pakistan", "Peru", "Philippines", "Poland", "Qatar", "Russia_USA", "Russia", "Saudi-Arabia", "Singapore_Taiwan", "Singapore", "Slovakia", "South-Africa", "South-Korea", "Spain", "Sweden", "Switzerland", "Taiwan_USA", "Taiwan", "Thailand", "Turkey", "Turkmenistan_Monaco", "Ukraine", "United-Arab-Emirates", "United-Kingdom_ESA", "United-Kingdom", "Uruguay", "USA_Argentina", "USA_Canada_Japan", "USA_Canada", "USA_France", "USA_Germany", "USA_Japan_Brazil", "USA_Japan", "USA_United-Kingdom_Italy", "USA", "Venezuela", "Vietnam"
        ];

        let bounds = [];
        let mids = [];
        let midsOriginal = [];

        let textHeight;
        let squareWidth;

        let imgHeight;
        let redVal = 255;
        let greenVal = 255;
        let blueVal = 0;

        let eye;
        let ear;

        let startMap = false;

        function preload(){

            eye = loadImage("data/img/eye.png");
            ear = loadImage("data/img/ear.png");

            for(let i = 0; i < countries.length; i++){
                maps.push(loadImage("data/img/map_img/" + countries[i] + ".png"));
            }
        }

        function setup(){
            //
            // let titleWidth = parseFloat(window.getComputedStyle(document.getElementById('title-div')).width);
            // let titleHeight = parseFloat(window.getComputedStyle(document.getElementById('title-div')).height);
            //
            // let marginLeft = (window.innerWidth * 0.6 - titleWidth) / 2;
            // let marginTop = (window.innerHeight * 0.2 - titleHeight);
            //
            // document.getElementById('title-div').style.marginLeft = marginLeft + "px";
            // document.getElementById('title-div').style.marginTop = marginTop + "px";
            //
            // console.log(titleWidth);

            pixelDensity(1);

            for(let i = 0; i < countries.length; i++){
                countries[i] = countries[i].replace("-", " ");
                countries[i] = countries[i].replace("-", " ");
                countries[i] = countries[i].replace("_", "/");
                countries[i] = countries[i].replace("_", "/");
                countries[i] = countries[i].replace("_", "/");
                countries[i] = countries[i].replace("_", "/");

                if(countries[i].indexOf("/") < 0){
                    let newCountry = document.createElement('div');
                    newCountry.innerHTML = countries[i];

                   // newCountry.id = countries[i];
                    newCountry.className = "map-list";

                    document.getElementById('map-index').appendChild(newCountry);

                    let newNum = document.createElement('div');
                    newNum.innerHTML = "0";
                    newNum.id = countries[i];
                    newNum.className = "map-list";
                    document.getElementById('map-num').appendChild(newNum);
                }
            }

            loadTable('data/sat.csv', parseData);
            let canvas = createCanvas(windowWidth, windowHeight);
            canvas.id("map-cvs");
            canvas.parent('p5-cvs');

            imgHeight = width * 0.7 / 574 * 332;

            for(let i = 0; i < maps.length; i++){
                maps[i].loadPixels();
                let pix = maps[i].pixels;

                let minX = maps[i].width;
                let maxX = 0;

                let minY = maps[i].height;
                let maxY = 0;

                for(let y = 0; y < maps[i].height; y++){
                    for(let x = 0; x < maps[i].width; x++){
                        let index = (y * maps[i].width + x) * 4;

                        if(pix[index] != 0){
                            if(x < minX){
                                minX = x;
                            }

                            if(x > maxX){
                                maxX = x;
                            }

                            if(y < minY){
                                minY = y;
                            }

                            if(y > maxY){
                                maxY = y;
                            }

                            pix[index] = 180;
                            pix[index + 1] = 180;
                            pix[index + 2] = 180;
                            pix[index + 3] = 50;
                        }
                    }
                }

                maps[i].updatePixels();

                bounds.push([minX, maxX, minY, maxY]);

                if(i === countries.length - 3){
                    mids.push([(maxX + minX) / 2 + 30, (maxY + minY) / 2 + 35]);

                }else{
                    mids.push([(maxX + minX) / 2, (maxY + minY) / 2]);
                }

                // let mappedMinX = map(minX, 0, maps[i].width, 0, width);
                // let mappedMaxX = map(maxX, 0, maps[i].width, 0, width);
                // let mappedMinY = map(minY, 0, maps[i].height, 0, imgHeight);
                // let mappedMaxY = map(maxY, 0, maps[i].height, 0, imgHeight);
                //
                // bounds.push([mappedMinX, mappedMaxX, mappedMinY, mappedMaxY]);
            }

            midsOriginal = mids;
        }

        let mapIndex = 0;
        let satObjects = [];

        function draw(){
            background(0);

            for(let i = 0; i < maps.length; i++){
                image(maps[i], width * 0.15, (height - imgHeight) / 2, width * 0.7, imgHeight);
            }
            // filter(BLUR, 2);

            for(let i = 0; i < satObjects.length; i++){
                satObjects[i].display();
            }

            if(startMap){

                if(frameCount % 2 === 0){

                    //do pix stuff here
                    if(satdata[mapIndex]){
                        let allCountries = satdata[mapIndex][6].split("/");

                        for(let i = 0; i < allCountries.length; i++){
                            let thisCountry = allCountries[i];

                            if(countries.indexOf(thisCountry) < countries.length && countries.indexOf(thisCountry) >= 0){

                                if(document.getElementById(thisCountry)){
                                    let currentNum = parseInt(document.getElementById(thisCountry).innerHTML);
                                    currentNum++;
                                    document.getElementById(thisCountry).innerHTML = currentNum;
                                }

                                let cIndex = countries.indexOf(thisCountry);
                                maps[cIndex].loadPixels();
                                let pix = maps[cIndex].pixels;

                                let box = bounds[cIndex];

                                let midX = mids[cIndex][0];
                                let midY = mids[cIndex][1];

                                // let randX = int(random(box[0], box[1]));
                                // let randY = int(random(box[2], box[3]));
                                //
                                //
                                // let randIndex = (randY * maps[cIndex].width + randX) * 4;
                                //
                                // while(pix[randIndex] === 0){
                                //     randX = int(random(box[0], box[1]));
                                //     randY = int(random(box[2], box[3]));
                                //
                                //     randIndex = (randY * maps[cIndex].width + randX) * 4;
                                // }

                                if(satdata[mapIndex][9].indexOf("Communications") >= 0){
                                    satObjects.push(new SatObj(0, midX, midY));
                                }else{
                                    satObjects.push(new SatObj(1, midX, midY));
                                }

                                mids[cIndex][0] += 0.5;
                                mids[cIndex][1] -= 0.5;

                                //bounds.push([mappedMinX, mappedMaxX, mappedMinY, mappedMaxY]);

                                for(let y = bounds[cIndex][2]; y < bounds[cIndex][3]; y++){
                                    for(let x = bounds[cIndex][0]; x < bounds[cIndex][1]; x++){
                                        let index = (y * maps[cIndex].width + x) * 4;

                                        if(pix[index] != 0){

                                            if(pix[index + 3] == 50){
                                                pix[index] = redVal;
                                                pix[index + 1] = greenVal;
                                                pix[index + 2] = blueVal;
                                            }

                                            if(pix[index + 3] < 255){
                                                pix[index + 3] += 1;
                                            }
                                        }
                                    }
                                }

                                maps[cIndex].updatePixels();
                            }else{
                                console.log(thisCountry + " not drawn");
                            }

                        }

                        mapIndex++;

                        if(mapIndex > satdata.length - 1) {
                            console.log("DONE");
                            startMap = false;
                        }
                    }

                }
            }
            //
            // fill(255, 30);
            // rect(bounds[0][0], bounds[0][2], bounds[0][1] - bounds[0][0], bounds[0][3] - bounds[0][2]);
        }

        class SatObj{
            constructor(type, x, y){
                if(type === 0){
                    this.img = eye;
                }else{
                    this.img = ear;
                }

                this.x = map(x, 0, maps[0].width, width * 0.15, width * 0.85);
                this.y = map(y, 0, maps[0].height, (height - imgHeight) / 2, imgHeight + (height - imgHeight) / 2);

                this.angle = radians(15);
            }

            display(){
                push();
                imageMode(CENTER);
                translate(this.x, this.y);
                rotate(this.angle);
                stroke(0);
                strokeWeight(0.2);
                fill(255, 120);
                rect(0, 0, 10, 10);
                //image(this.img, 0, 0);
                pop();
            }
        }

        function parseData(dat){

            for(let i = 0; i < dat.rows[0].arr.length; i++){
                if(dat.rows[0].arr[i] !== ""){
                    satHeader.push(dat.rows[0].arr[i]);
                }
            }

            for(let i = 1; i < dat.rows.length; i++){
                let currentSat = [];

                if(dat.rows[i].arr[18] !== ""){
                    let date = dat.rows[i].arr[18].split("/");

                    let year = parseInt(date[2]);

                    if(year > 20){
                        year += 1900;
                    }else{
                        year += 2000;
                    }

                    let month = parseInt(date[0]) - 1;
                    let day = parseInt(date[1]);

                    currentSat.push(new Date(year, month, day).getTime());
                    currentSat.push(year);
                    currentSat.push(month);
                    currentSat.push(day);
                }

                for(let j = 0; j < dat.rows[i].arr.length; j++){
                    currentSat.push(dat.rows[i].arr[j]);
                }

                satdata.push(currentSat);
            }

            satdata.sort(Comparator);

            for(let i = 0; i < satdata.length; i++){
                if(satYears.indexOf(satdata[i][1]) < 0){
                    satYears.push(satdata[i][1]);
                    satYearCount.push(0);
                }

                satYearCount[satYears.indexOf(satdata[i][1])]++;

            }

            textHeight = HEIGHT / (satYears.length * 2);

            for(let i = 0; i < satYears.length; i++){
                let newDiv = document.createElement('div');
                newDiv.id = satYears[i];

                let newP = document.createElement('span');
                newP.innerHTML = satYears[i];

                newP.style.fontSize = textHeight + "px";
                newDiv.style.marginTop = textHeight / 2 + "px";
                newDiv.style.marginBottom = textHeight / 2 + "px";

                let triangle = document.createElement('span');
                triangle.innerHTML = "▸";
                triangle.style.marginRight = "5px";
                triangle.style.marginLeft = "3px";

                if(i != 0){
                    triangle.style.visibility = "hidden";
                }else{
                    triangle.style.visibility = "visible";
                }

                newDiv.appendChild(newP);
                newDiv.appendChild(triangle);
                document.getElementById('timeline').appendChild(newDiv);

            }

            let timeHeight = parseFloat(window.getComputedStyle(document.getElementById('timeline')).height);

            let margin = (HEIGHT - timeHeight) / 2;
            document.getElementById('timeline').style.marginTop = margin + "px";
            // document.getElementsByClassName('info')[0].style.marginTop = margin + "px";

            squareWidth = (WIDTH / 2) / 400;
        }

        function Comparator(a, b) {
            if (a[0] < b[0]) return -1;
            if (a[0] > b[0]) return 1;
            return 0;
        }

        let satIndex = 0;

        let catCount = [0, 0, 0, 0, 0];

        let yearTransDone = false;
        let yearsAlpha = 0;
        let yearsBgPos = 125;

        let homeTransDone = false;

        let mode = 0;

        function home(){



            document.getElementById('card').style.display = "none";

            clearInterval(addSat);
            clearInterval(timer);

            for(let i = 0 ; i < sats.length; i++){
                let currentSat = scene.getObjectByName(sats[i].name);
                scene.remove(currentSat);
            }

            sats = [];
            particles = [];
            catCount = [0, 0, 0, 0, 0];
            satIndex = 0;
            yearTransDone = false;


            if(times){
                for(let i = 0; i < times.length; i++){
                    times[i].children[1].style.visibility = "hidden";
                }

                document.getElementById("1974").children[1].style.visibility = "visible";
            }

            console.log("start back");

            let yearsTrans = setInterval(function(){

                if(yearsAlpha > 0){
                    yearsAlpha -= 0.1;
                    document.getElementById('by-years').style.opacity = yearsAlpha;

                    homeTransDone = false;
                }else{
                    homeTransDone = true;
                }


                if(infoOpacity > 0){
                    infoOpacity -= 0.1;
                    document.getElementById('info-panel').style.opacity = infoOpacity;
                    homeTransDone = false;
                }else{
                    homeTransDone = true;
                    document.getElementById('info-panel').style.top = "100vh";

                }

                if(mode === 2){
                    if(camera.position.x > 0){
                        camera.position.x -= 1;
                        homeTransDone = false;

                    }else{
                        camera.position.x = 0;

                        homeTransDone = true;
                    }

                    if(earth.position.x > 0){
                        earth.position.x -= 2;
                        homeTransDone = false;

                    }else{
                        earth.position.x = 0;

                        homeTransDone = true;
                    }

                    // if(yearsBgPos < 125){
                    //     yearsBgPos += 0.5;
                    //     document.body.style.backgroundPosition = yearsBgPos + "%";
                    //     homeTransDone = false;
                    // }else{
                    //     homeTransDone = true;
                    // }
                }else if(mode === 1){
                    if(camera.position.x < 0){
                        camera.position.x += 1;
                        homeTransDone = false;

                    }else{
                        camera.position.x = 0;

                        homeTransDone = true;
                    }

                    if(earth.position.x < 0){
                        earth.position.x += 2;
                        homeTransDone = false;

                    }else{
                        earth.position.x = 0;

                        homeTransDone = true;
                    }

                    // if(yearsBgPos > 125){
                    //     yearsBgPos -= 0.5;
                    //     document.body.style.backgroundPosition = yearsBgPos + "%";
                    //     homeTransDone = false;
                    // }else{
                    //     homeTransDone = true;
                    // }
                }



                if(homeTransDone){
                    console.log("stop interval");
                    clearInterval(yearsTrans);
                    homeTransDone = false;
                    mode = 0;

                }


            }, 20);



        }

        let infoOpacity = 0;

        function info(){

            startMap = false;

            // mapIndex = 0;
            // satObjects = [];
            //
            // mids = midsOriginal;

            document.getElementById('card').style.display = "none";

            clearInterval(addSat);
            clearInterval(timer);

            for(let i = 0 ; i < sats.length; i++){
                let currentSat = scene.getObjectByName(sats[i].name);
                scene.remove(currentSat);
            }

            sats = [];
            particles = [];
            catCount = [0, 0, 0, 0, 0];
            satIndex = 0;
            yearTransDone = false;

            if(times){
                for(let i = 0; i < times.length; i++){
                    times[i].children[1].style.visibility = "hidden";
                }

                document.getElementById("1974").children[1].style.visibility = "visible";
            }

            console.log("start back");

            let yearsTrans = setInterval(function(){

                let topSize = parseInt(window.getComputedStyle(document.getElementById('map-cvs')).top);
                let alpha = parseFloat(window.getComputedStyle(document.getElementById('map-cvs')).opacity);


                if(yearsAlpha > 0){
                    yearsAlpha -= 0.1;
                    document.getElementById('by-years').style.opacity = yearsAlpha;

                    homeTransDone = false;
                }else{
                    homeTransDone = true;
                }


                if(topSize < window.innerHeight){
                    topSize += 20;

                    document.getElementById('map-cvs').style.top = topSize + "px";

                    homeTransDone = false;
                }else{
                    homeTransDone = true;
                }


                if(alpha > 0){
                    alpha -= 0.01;

                    document.getElementById('map-cvs').style.opacity = alpha;
                    document.getElementById('map-info').style.opacity = alpha;

                    homeTransDone = false;
                }else{
                    homeTransDone = true;
                }

                if(mode === 2){
                    if(camera.position.x > 0){
                        camera.position.x -= 1;
                        homeTransDone = false;

                    }else{
                        camera.position.x = 0;

                        homeTransDone = true;
                    }

                    if(earth.position.x > 0){
                        earth.position.x -= 2;
                        homeTransDone = false;

                    }else{
                        earth.position.x = 0;

                        homeTransDone = true;
                    }

                    // if(yearsBgPos < 125){
                    //     yearsBgPos += 0.5;
                    //     document.body.style.backgroundPosition = yearsBgPos + "%";
                    //     homeTransDone = false;
                    // }else{
                    //     homeTransDone = true;
                    // }
                }else if(mode === 1){
                    if(camera.position.x < 0){
                        camera.position.x += 1;
                        homeTransDone = false;

                    }else{
                        camera.position.x = 0;

                        homeTransDone = true;
                    }

                    if(earth.position.x < 0){
                        earth.position.x += 2;
                        homeTransDone = false;

                    }else{
                        earth.position.x = 0;

                        homeTransDone = true;
                    }

                    // if(yearsBgPos > 125){
                    //     yearsBgPos -= 0.5;
                    //     document.body.style.backgroundPosition = yearsBgPos + "%";
                    //     homeTransDone = false;
                    // }else{
                    //     homeTransDone = true;
                    // }
                }



                if(homeTransDone){
                    console.log("stop interval");
                    clearInterval(yearsTrans);
                    homeTransDone = false;
                    mode = 0;

                    let infoHeight = parseFloat(window.getComputedStyle(document.getElementById('info-panel')).height);
                    let infoTop = HEIGHT / 2 - infoHeight / 2;

                    document.getElementById('info-panel').style.top = infoTop + "px";


                    let showInfo = setInterval(function(){

                        if(infoOpacity < 1){
                            infoOpacity += 0.1;
                            document.getElementById('info-panel').style.opacity = infoOpacity;
                        }else{
                            clearInterval(showInfo);
                        }

                    }, 50);

                }


            }, 40);


        }

        let cardsTransDone = false;

        let addSat;

        function viewCards(){

            mode = 1;

            startMap = false;

            console.log("cards start back");

            clearInterval(timer);

            for(let i = 0 ; i < sats.length; i++){
                let currentSat = scene.getObjectByName(sats[i].name);
                scene.remove(currentSat);
            }

            sats = [];
            particles = [];
            catCount = [0, 0, 0, 0, 0];
            satIndex = 0;
            yearTransDone = false;

            if(times){
                for(let i = 0; i < times.length; i++){
                    times[i].children[1].style.visibility = "hidden";
                }

                document.getElementById("1974").children[1].style.visibility = "visible";
            }


            let yearsTrans = setInterval(function(){


                let topSize = parseInt(window.getComputedStyle(document.getElementById('map-cvs')).top);
                let alpha = parseFloat(window.getComputedStyle(document.getElementById('map-cvs')).opacity);


                if(infoOpacity > 0){
                    infoOpacity -= 0.1;
                    document.getElementById('info-panel').style.opacity = infoOpacity;

                    cardsTransDone = false;
                }else{
                    cardsTransDone = true;
                    document.getElementById('info-panel').style.top = "100vh";

                }

                if(yearsAlpha > 0){
                    yearsAlpha -= 0.1;
                    document.getElementById('by-years').style.opacity = yearsAlpha;

                    cardsTransDone = false;
                }else{
                    cardsTransDone = true;
                }

                if(topSize < window.innerHeight){
                    topSize += 25;

                    document.getElementById('map-cvs').style.top = topSize + "px";

                    cardsTransDone = false;
                }else{
                  //  cardsTransDone = true;
                }


                if(alpha > 0){
                    alpha -= 0.01;

                    document.getElementById('map-cvs').style.opacity = alpha;
                    document.getElementById('map-info').style.opacity = alpha;

                    cardsTransDone = false;
                }else{
                  //  cardsTransDone = true;
                }

                if(camera.position.x > -20){
                    camera.position.x -= 1;
                    cardsTransDone = false;

                }else{
                    camera.position.x = -20;

                   // cardsTransDone = true;
                }

                if(earth.position.x > -60){
                    earth.position.x -= 2;
                    cardsTransDone = false;

                }else{
                    earth.position.x = -60;

                   // cardsTransDone = true;
                }





                // if(yearsBgPos < 145){
                //     yearsBgPos += 0.5;
                //     document.body.style.backgroundPosition = yearsBgPos + "%";
                //     cardsTransDone = false;
                // }else{
                //     cardsTransDone = true;
                // }



                if(cardsTransDone){
                    console.log("stop interval");
                    clearInterval(yearsTrans);
                    cardsTransDone = false;

                    document.getElementById('card').style.display = "block";

                    xorigin = -60;

                    let clickSatIndex = 0;

                    addSat = setInterval(function(){
                        createSat(clickSatIndex, Math.random() * -100, Math.random() * 100 - 50, 0, 0xffffff ,frameCount, true);

                        clickSatIndex++;
                        if(clickSatIndex > 418){
                            clearInterval(addSat);
                        }

                    }, 500);

                }


            }, 50);


        }

        let mapTransDone = false;

        function showmap(){
           home();

            console.log("in map");

            let moveMap = setInterval(function(){

                let topSize = parseInt(window.getComputedStyle(document.getElementById('map-cvs')).top);
                let alpha = parseFloat(window.getComputedStyle(document.getElementById('map-cvs')).opacity);

                if(topSize > 0){
                    topSize -= 10;

                    document.getElementById('map-cvs').style.top = topSize + "px";

                    mapTransDone = false;
                }else{
                    mapTransDone = true;
                }


                if(alpha < 1){
                    alpha += 0.01;

                    document.getElementById('map-cvs').style.opacity = alpha;
                    document.getElementById('map-info').style.opacity = alpha;


                    mapTransDone = false;
                }else{
                    mapTransDone = true;
                }

                if(mapTransDone){
                    clearInterval(moveMap);

                    startMap = true;
                    mapTransDone = false;
                }
            }, 20);
        }

        let timer;
        let times;

        function satByYears(){

            mode = 2;

            startMap = false;


            clearInterval(addSat);

            document.getElementById('card').style.display = "none";

            for(let i = 0 ; i < sats.length; i++){
                let currentSat = scene.getObjectByName(sats[i].name);
                scene.remove(currentSat);
            }

            xorigin = 40;

            sats = [];
            particles = [];
            catCount = [0, 0, 0, 0, 0];
            satIndex = 0;

            // camera.position.x = 10;
            //  earth.position.x = 40;

            let trans = setInterval(function(){

                let topSize = parseInt(window.getComputedStyle(document.getElementById('map-cvs')).top);
                let alpha = parseFloat(window.getComputedStyle(document.getElementById('map-cvs')).opacity);

                yearsAlpha += 0.01;
                document.getElementById('by-years').style.opacity = yearsAlpha;
                //
                // if(yearsBgPos > 105){
                //     yearsBgPos -= 0.5;
                // }
                // document.body.style.backgroundPosition = yearsBgPos + "%";

                if(infoOpacity > 0){
                    infoOpacity -= 0.1;
                    document.getElementById('info-panel').style.opacity = infoOpacity;
                    yearTransDone = false;

                }else{
                    document.getElementById('info-panel').style.top = "100vh";

                    yearTransDone = true;

                }

                if(topSize < window.innerHeight){
                    topSize += 10;

                    document.getElementById('map-cvs').style.top = topSize + "px";

                    cardsTransDone = false;
                }else{
                    cardsTransDone = true;
                }


                if(alpha > 0){
                    alpha -= 0.01;

                    document.getElementById('map-cvs').style.opacity = alpha;
                    document.getElementById('map-info').style.opacity = alpha;


                    cardsTransDone = false;
                }else{
                    cardsTransDone = true;
                }

                if(camera.position.x < 10){
                    camera.position.x += 0.1;
                    yearTransDone = false;

                }else{
                    yearTransDone = true;
                }

                if(earth.position.x < 40){
                    earth.position.x += 0.5;
                    yearTransDone = false;

                }else{
                    yearTransDone = true;
                }



                if(yearTransDone){
                    clearInterval(trans);

                    console.log("start sat movement");

                    document.getElementById('by-years').style.display = "block";

                    timer = setInterval(function(){

                        console.log(satIndex);

                        let currentYear = satdata[satIndex][1];
                        document.getElementById('year').innerHTML = currentYear;

                        if(document.getElementById(currentYear).children[1].style.visibility !== "visible"){
                            times = document.getElementById('timeline').children;

                            for(let i = 0; i < times.length; i++){
                                times[i].children[1].style.visibility = "hidden";
                            }

                            document.getElementById(currentYear).children[1].style.visibility = "visible";
                        }

                        let yearIndex = satYears.indexOf(currentYear);
                        let satY = 100 / 33 * yearIndex;

                        let categories = satdata[satIndex][8].split('/');

                        for(let i = 0; i < categories.length; i++){
                            let square = document.createElement('div');
                            square.style.width = squareWidth + "px";
                            square.style.height = textHeight + "px";
                            square.style.display = "inline-block";
                            square.className = "counter";

                            let colHex = 0;

                            if(categories[i] === "Civil"){
                                square.style.background = "rgba(247, 194, 66, 0.8)";
                                colHex = 0xf7c242;
                                catCount[0]++;
                            }else if(categories[i] === "Government"){
                                square.style.background = "rgba(224, 60, 138, 0.8)";
                                colHex = 0xe03c8a;
                                catCount[1]++;
                            }else if(categories[i] === "Commercial"){
                                square.style.background = "rgba(88, 178, 220, 0.8)";
                                colHex = 0x58b2dc;
                                catCount[2]++;
                            }else if(categories[i] === "Military"){
                                square.style.background = "rgba(144, 180, 75, 0.8)";
                                colHex = 0x8fb54c;
                                catCount[3]++;
                            }else{
                                square.style.background = "rgba(255, 255, 255, 0.8)";
                            }
                            document.getElementById(currentYear).appendChild(square);

                            createSat(sats.length - 1, -80, 50 - satY, 0, colHex, frameCount, false);
                        }

                        if(Math.random() < 0.2){
                            let square = document.createElement('div');
                            square.style.width = squareWidth + "px";
                            square.style.height = textHeight + "px";
                            square.style.display = "inline-block";
                            square.style.background = "rgba(255, 255, 255, 0.8)";

                            document.getElementById(currentYear).appendChild(square);

                            catCount[4]++;

                            createSat(sats.length - 1, -80, 50 - satY, 0, 0xffffff, frameCount, false);
                        }


                        document.getElementById('civil').innerHTML = catCount[0];
                        document.getElementById('gov').innerHTML = catCount[1];
                        document.getElementById('com').innerHTML = catCount[2];
                        document.getElementById('mil').innerHTML = catCount[3];
                        document.getElementById('unknown').innerHTML = catCount[4];

                        satIndex++;

                        if(satIndex > satdata.length - 1){
                            clearInterval(timer);
                            console.log("done");
                        }


                    }, 100);
                }

            }, 10);

        }


        if (!Detector.webgl) Detector.addGetWebGLMessage();

        //reset selected
        let selected = -1;

        let perlin = new ImprovedNoise();

        window.addEventListener('resize', onWindowResize, false);

        THREE.Object3D.prototype.rotateAroundWorldAxis = function() {
            var q1 = new THREE.Quaternion();
            return function ( point, axis, angle ) {
                q1.setFromAxisAngle( axis, angle );
                this.quaternion.multiplyQuaternions( q1, this.quaternion );
                this.position.sub( point );
                this.position.applyQuaternion( q1 );
                this.position.add( point );
                return this;
            }
        }();

        let WIDTH = window.innerWidth;
        let HEIGHT = window.innerHeight;
        let camera = new THREE.PerspectiveCamera(60, WIDTH / HEIGHT, 0.01, 1500);
        camera.position.z = 120;

        let renderer = new THREE.WebGLRenderer({
          canvas: document.querySelector('#webgl'),
          antialias: true,
          alpha: true
        });

        let sats = [];
        let particles = [];

        renderer.setSize(WIDTH, HEIGHT);
        renderer.autoClear = false;
        renderer.setClearColor(0x000000, 0.0);

        let controls = new THREE.OrbitControls(camera, renderer.domElement);
        controls.enableRotate = false;

        let scene = new THREE.Scene();
        let interaction = new THREE.Interaction(renderer, scene, camera);
        scene.fog = new THREE.Fog(0x000000, 0, 400);

        let earthMaterial = new THREE.MeshPhongMaterial({});
        earthMaterial.map = THREE.ImageUtils.loadTexture('data/img/earthmap4k.jpg');

        let earth = new THREE.Mesh(
            new THREE.SphereGeometry(35, 32, 32),
            earthMaterial
        );


       scene.add(earth);

       let stars = new THREE.Object3D();
       scene.add(stars);

       let starMaterial = new THREE.MeshPhongMaterial({
           color: 0xffffff,
           shading: THREE.FlatShading
       });

        let starGeo = new THREE.TetrahedronGeometry(0.2, 0);


        for (let i = 0; i < 300; i++) {
            let mesh = new THREE.Mesh(starGeo, starMaterial);
            mesh.position.set(Math.random() - 0.5, Math.random() - 0.5, Math.random() - 0.5).normalize();
            mesh.position.multiplyScalar(50 + (Math.random() * 100));
            mesh.rotation.set(Math.random() * 2, Math.random() * 2, Math.random() * 2);
            stars.add(mesh);
        }


        // let hemlight = new THREE.HemisphereLight( 0xffffff, 0x000000, 1 );
        // scene.add( hemlight );

        function createSat(i, x, y, z, c, frame, addClick){
            particles.push(new Particle(x, y, z));

            let bsize = THREE.Math.randFloat(0.1, 0.3);

            if(addClick){
                bsize = 1;
            }

            let cube = new THREE.Mesh(
                new THREE.SphereGeometry(bsize, 18, 18),
                new THREE.MeshPhongMaterial({
                    color: c,
                    transparent: true,
                    opacity: 0.9
                })
            );
            cube.cursor = 'pointer';

            cube.position.x = x;
            cube.position.y = y;
            cube.position.z = z;

            cube.xOffset = THREE.Math.randFloat(0.001, 0.003);
            cube.yOffset = THREE.Math.randFloat(0.001, 0.003);

            cube.startFrame = frame;
            cube.endTransition = false;
            cube.alpha = 0;

            cube.name = 'sat-' + sats.length;

            sats.push(cube);
            scene.add(sats[sats.length - 1]);

            if(addClick){
                sats[i].on('mouseover', function(ev) {
                    sats[i].material.color.r = 0;
                    selected = i;
                    console.log(selected);
                    document.getElementById('card-img').src = "data/img/" + selected + ".png";
                });

                sats[i].on('mouseout', function(ev) {
                    sats[i].material.color.r = 1;
                });
            }

        }
        
        let ambient = new THREE.AmbientLight( 0xdddddd );
        scene.add( ambient );

        // let light = new THREE.PointLight(0xffffff);
        // light.position.set(20, 50, 50);
        // scene.add(light);
        //
        // var lights = [];
        // lights[0] = new THREE.DirectionalLight( 0xffffff, 1 );
        // lights[0].position.set( 1, 0, 0 );
        // lights[1] = new THREE.DirectionalLight( 0x11E8BB, 1 );
        // lights[1].position.set( 0.75, 1, 0.5 );
        // lights[2] = new THREE.DirectionalLight( 0x8200C9, 1 );
        // lights[2].position.set( -0.75, -1, 0.5 );
        // scene.add( lights[0] );
        // scene.add( lights[1] );
        // scene.add( lights[2] );


        let frameCount = 0;
        let xorigin = 40;

        let clock = new THREE.Clock(true);

        function render() {

            earth.rotation.y = frameCount * 0.001;

            for (let i = 0; i < particles.length; i++) {
                let p = particles[i];

                let x = 40 * Math.cos((frameCount) * sats[i].xOffset) * Math.sin((frameCount) * sats[i].yOffset) + xorigin;
                let y = 40 * Math.sin((frameCount) * sats[i].xOffset) * Math.sin((frameCount) * sats[i].yOffset);
                let z = 40 * Math.cos((frameCount) * sats[i].yOffset);

                p.pos = new THREE.Vector3(x, y, z);
            }

            let delta = clock.getDelta();

            let currentX, currentY, currentZ;

        	for(let i = 0; i < sats.length; i++){

                if(!sats[i].endTransition){
        	        currentX = Math.abs(particles[i].pos.x - sats[i].position.x);
        	        currentY = Math.abs(particles[i].pos.y - sats[i].position.y);
        	        currentZ = Math.abs(particles[i].pos.z - sats[i].position.z);
                }
                else{
                    sats[i].position.x = particles[i].pos.x;
                    sats[i].position.y = particles[i].pos.y;
                    sats[i].position.z = particles[i].pos.z;
                }

                if (currentX >= 0.1 || currentY >= 0.1 || currentZ >= 0.1) {
                    sats[i].alpha += delta * 3;
                    sats[i].position.lerp(particles[i].pos, sats[i].alpha);
                } else {
                    sats[i].endTransition = true;
                }
        	}

            stars.rotation.x += 0.0000;
            stars.rotation.y -= 0.0040;
          
          renderer.render(scene, camera);
          requestAnimationFrame(render);
          frameCount++;
        }
        render();

        function onWindowResize() {
          camera.aspect = (window.innerWidth) / window.innerHeight;
          camera.updateProjectionMatrix();
          renderer.setSize(window.innerWidth, window.innerHeight);
        }


      </script>

    </body>

    </html>

