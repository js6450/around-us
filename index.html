<html>
    <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta http-equiv="Cache-Control" content="no-cache">
      <meta name="viewport" content="initial-scale=1.0,maximum-scale=1.0,minimum-scale=1.0,user-scalable=no">
      <link href="https://fonts.googleapis.com/css?family=Ubuntu&display=swap" rel="stylesheet">
      <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.7.1/p5.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.7.1/addons/p5.dom.min.js"></script>      <script src=""></script>
      <title>Satellites</title>

    </head>
    <style>

      body{
        margin: 0;
        overflow: hidden;
        font-family: 'Ubuntu', sans-serif;
        background: linear-gradient(to right,  #000000, #ffffff, #000000); /* W3C, IE10+, FF16+, Chrome26+, Opera12+, Safari7+ */
        background-size: 300% 100%;
        background-position: 125%;
        /*background-position: 105%;*/
          /*background-position: 145%;*/


      }

      #timeline{
          position: fixed;
          color: black;
          margin-left: 64px;

      }

      .info{
          position: fixed;
          color: white;
          top: 40vh;
          left: 20vw;
      }

      #year{
          font-size: 36px;
      }

      #title{
          font-size: 42px;
      }

      #year-div, #title-div{
          margin-bottom: 18px;
          margin-left: 14px;
      }

      #title-div{
          position: fixed;
          color: white;
          top: calc(40vh - 58px);
          left: 20vw;
      }

      #civil-block, #gov-block, #com-block, #mil-block, #unknown-block{
          width: 18px;
          height: 5px;
          display: inline-block;
          margin-bottom: 3px;
          margin-right: 8px;
          margin-left: 8px;
      }

      #civil, #gov, #com, #mil, #unknown{
          width: 30px;
          display: inline-block;
          text-align: right;

          margin-bottom: 6px;
          margin-top: 0;
      }

      #civil-block{
          background: rgb(247, 194, 66);
      }

      #gov-block{
          background: rgb(224, 60, 138);
      }

      #com-block{
          background: rgb(88, 178, 220);
      }

      #mil-block{
          background: rgb(144, 180, 75);
      }

      #unknown-block{
          background: rgb(255, 255, 255);
      }

      #by-years{
          opacity: 0;
      }

      #by-year-btn{
          transform: rotateZ(90deg);
          transform-origin: left;
          position: fixed;
          right: -68px;
          background-color: transparent;
          color: white;
          top: calc(50vh - 45px);
          transition: background-color 1s, color 1s;
      }

      #cards-btn{
          transform: rotateZ(-90deg);
          transform-origin: right;
          position: fixed;
          left: -68px;
          background-color: transparent;
          color: white;
          top: calc(50vh - 45px);
          transition: background-color 1s, color 1s;
      }

      #home-btn{
          position: fixed;
          right: calc(50vw - 45px);
          background-color: transparent;
          color: white;
          top: 18px;
          transition: background-color 1s, color 1s;
      }


      #info-btn{
          transform: rotateZ(180deg);

          position: fixed;
          right: calc(50vw - 45px);
          background-color: transparent;
          color: white;
          bottom: 18px;
          transition: background-color 1s, color 1s;
      }

        #by-year-btn-span, #cards-btn-span, #home-span, #info-btn-span{
            padding: 4px;
        }

      #by-year-btn:hover, #cards-btn-span:hover, #home-span:hover, #info-btn-span:hover{
          cursor: pointer;
          transition: background-color 1s, color 1s;
          background-color: white;
          color: black;
      }



      #info-panel{
          width: 40vw;
          position: fixed;
          top: 100vh;
          color: white;
          background: rgba(0, 0, 0, 0.5);
          padding: 12px 24px;
          border-radius: 12px;
          left: calc((100vw - 40vw - 48px) / 2);
          opacity: 0;
      }



      #card{
        width: 35vw;
        height: 100vh;
        /*background: #0B1013;*/
        position: absolute;
        top: 0;
        right: 84px;
          display: none;
      }

      #card-img{
        margin: auto;
        display: block;
        margin-top: calc((100vh - 31.5vw) / 2);
      }

      a{
        color: white;
      }
    </style>
    <body>
      <div id="by-years">
          <div id="timeline"></div>
          <div class="info">
              <!--<div id="title-div"><span id="title">Around Us</span></div>-->
              <div id="year-div"><span id="year">1974</span></div>
              <div id="civil-div">
                  <p id="civil">0</p><div id="civil-block"></div><span>Civil</span>
              </div>
              <div id="gov-div">
                  <p id="gov">0</p><div id="gov-block"></div><span>Government</span>
              </div>
              <div id="com-div">
                  <p id="com">0</p><div id="com-block"></div><span>Commercial</span>
              </div>
              <div id="mil-div">
                  <p id="mil">0</p><div id="mil-block"></div><span>Military</span>
              </div>
              <div id="unknown-div">
                  <p id="unknown">0</p><div id="unknown-block"></div><span>????????</span>
              </div>
          </div>
      </div>
      <!--<div id="title-div"><span id="title">Around Us</span></div>-->
      <div id="menu">
          <div onclick="satByYears()" id="by-year-btn"><span id="by-year-btn-span">AROUND US</span></div>
          <div onclick="viewCards()" id="cards-btn"><span id="cards-btn-span">AROUND US</span></div>
          <div onclick="home()" id="home-btn"><span id="home-span">AROUND US</span></div>
          <div onclick="info()" id="info-btn"><span id="info-btn-span">AROUND US</span></div>
      </div>

      <canvas id="webgl"></canvas>
      <div id=card>
        <img width="60%" height="auto" id="card-img" src="data/img/cover.png">
      </div>
      <div id="info-panel">
          <p>How was your day?  Did you check the weather when you woke up?  You have a plan to go to a new restaurant, but you don't know how to get there.<br>What allows you to check the weather and find directions to a place?</p>
          <p>In spirit Lisa Park’s <i>Stuff You Can Kick: Toward a Theory of Media Infrastructures</i>, we are investigating the infrastructure of satellites launched in the year 2018 - 19. Satellites have become one of the most essential infrastructures that make distribution of media possible and like most media infrastructures, the extent of the structure is hard to be visually represented in one glance and no human can physically see the whole infrastructure. To add to this difficulty of visualizing infrastructures, satellites, once launched to the Earth’s orbit, are no longer visible to the human eye. Around Us raises awareness of these satellites that comprise an important infrastructure to digital media communications and also what and how “actual” numbers of something flying around the earth.
          </p>
      </div>
      <script src="js/three.min.js"></script>
      <script src="js/three.interaction.js"></script>
      <script src="js/OrbitControls.js"></script>
      <script src="js/Detector.js"></script>
      <script src="js/ImprovedNoise.js"></script>
      <script src="js/Particle.js"></script>
      <script>

        let satdata = [];
        let satHeader = [];

        let satYears = [];
        let satYearCount = [];

        let textHeight;
        let squareWidth;

        function setup(){
            //
            // let titleWidth = parseFloat(window.getComputedStyle(document.getElementById('title-div')).width);
            // let titleHeight = parseFloat(window.getComputedStyle(document.getElementById('title-div')).height);
            //
            // let marginLeft = (window.innerWidth * 0.6 - titleWidth) / 2;
            // let marginTop = (window.innerHeight * 0.2 - titleHeight);
            //
            // document.getElementById('title-div').style.marginLeft = marginLeft + "px";
            // document.getElementById('title-div').style.marginTop = marginTop + "px";
            //
            // console.log(titleWidth);

            loadTable('data/sat.csv', parseData);
            noCanvas();
        }

        function parseData(dat){

            for(let i = 0; i < dat.rows[0].arr.length; i++){
                if(dat.rows[0].arr[i] !== ""){
                    satHeader.push(dat.rows[0].arr[i]);
                }
            }

            for(let i = 1; i < dat.rows.length; i++){
                let currentSat = [];

                if(dat.rows[i].arr[18] !== ""){
                    let date = dat.rows[i].arr[18].split("/");

                    let year = parseInt(date[2]);

                    if(year > 20){
                        year += 1900;
                    }else{
                        year += 2000;
                    }

                    let month = parseInt(date[0]) - 1;
                    let day = parseInt(date[1]);

                    currentSat.push(new Date(year, month, day).getTime());
                    currentSat.push(year);
                    currentSat.push(month);
                    currentSat.push(day);
                }

                for(let j = 0; j < dat.rows[i].arr.length; j++){
                    currentSat.push(dat.rows[i].arr[j]);
                }

                satdata.push(currentSat);
            }

            satdata.sort(Comparator);

            for(let i = 0; i < satdata.length; i++){
                if(satYears.indexOf(satdata[i][1]) < 0){
                    satYears.push(satdata[i][1]);
                    satYearCount.push(0);
                }

                satYearCount[satYears.indexOf(satdata[i][1])]++;

            }

            textHeight = HEIGHT / (satYears.length * 2);

            for(let i = 0; i < satYears.length; i++){
                let newDiv = document.createElement('div');
                newDiv.id = satYears[i];

                let newP = document.createElement('span');
                newP.innerHTML = satYears[i];

                newP.style.fontSize = textHeight + "px";
                newDiv.style.marginTop = textHeight / 2 + "px";
                newDiv.style.marginBottom = textHeight / 2 + "px";

                let triangle = document.createElement('span');
                triangle.innerHTML = "▸";
                triangle.style.marginRight = "5px";
                triangle.style.marginLeft = "3px";

                if(i != 0){
                    triangle.style.visibility = "hidden";
                }else{
                    triangle.style.visibility = "visible";
                }

                newDiv.appendChild(newP);
                newDiv.appendChild(triangle);
                document.getElementById('timeline').appendChild(newDiv);

            }

            let timeHeight = parseFloat(window.getComputedStyle(document.getElementById('timeline')).height);

            let margin = (HEIGHT - timeHeight) / 2;
            document.getElementById('timeline').style.marginTop = margin + "px";

            squareWidth = (WIDTH * 3 / 4) / 400;
        }

        function Comparator(a, b) {
            if (a[0] < b[0]) return -1;
            if (a[0] > b[0]) return 1;
            return 0;
        }

        let satIndex = 0;

        let catCount = [0, 0, 0, 0, 0];

        let yearTransDone = false;
        let yearsAlpha = 0;
        let yearsBgPos = 125;

        let homeTransDone = false;

        let mode = 0;

        function home(){


            document.getElementById('card').style.display = "none";

            clearInterval(addSat);
            clearInterval(timer);

            for(let i = 0 ; i < sats.length; i++){
                let currentSat = scene.getObjectByName(sats[i].name);
                scene.remove(currentSat);
            }

            sats = [];
            particles = [];
            catCount = [0, 0, 0, 0, 0];
            satIndex = 0;
            yearTransDone = false;

            if(times){
                for(let i = 0; i < times.length; i++){
                    times[i].children[1].style.visibility = "hidden";
                }

                document.getElementById("1974").children[1].style.visibility = "visible";
            }

            console.log("start back");

            let yearsTrans = setInterval(function(){



                if(yearsAlpha > 0){
                    yearsAlpha -= 0.1;
                    document.getElementById('by-years').style.opacity = yearsAlpha;

                    homeTransDone = false;
                }else{
                    homeTransDone = true;
                }


                if(infoOpacity > 0){
                    infoOpacity -= 0.1;
                    document.getElementById('info-panel').style.opacity = infoOpacity;
                    homeTransDone = false;
                }else{
                    homeTransDone = true;
                    document.getElementById('info-panel').style.top = "100vh";

                }

                if(mode === 2){
                    if(camera.position.x > 0){
                        camera.position.x -= 1;
                        homeTransDone = false;

                    }else{
                        camera.position.x = 0;

                        homeTransDone = true;
                    }

                    if(earth.position.x > 0){
                        earth.position.x -= 2;
                        homeTransDone = false;

                    }else{
                        earth.position.x = 0;

                        homeTransDone = true;
                    }

                    if(yearsBgPos < 125){
                        yearsBgPos += 0.5;
                        document.body.style.backgroundPosition = yearsBgPos + "%";
                        homeTransDone = false;
                    }else{
                        homeTransDone = true;
                    }
                }else if(mode === 1){
                    if(camera.position.x < 0){
                        camera.position.x += 1;
                        homeTransDone = false;

                    }else{
                        camera.position.x = 0;

                        homeTransDone = true;
                    }

                    if(earth.position.x < 0){
                        earth.position.x += 2;
                        homeTransDone = false;

                    }else{
                        earth.position.x = 0;

                        homeTransDone = true;
                    }

                    if(yearsBgPos > 125){
                        yearsBgPos -= 0.5;
                        document.body.style.backgroundPosition = yearsBgPos + "%";
                        homeTransDone = false;
                    }else{
                        homeTransDone = true;
                    }
                }



                if(homeTransDone){
                    console.log("stop interval");
                    clearInterval(yearsTrans);
                    homeTransDone = false;
                    mode = 0;

                }


            }, 50);



        }

        let infoOpacity = 0;

        function info(){


            document.getElementById('card').style.display = "none";

            clearInterval(addSat);
            clearInterval(timer);

            for(let i = 0 ; i < sats.length; i++){
                let currentSat = scene.getObjectByName(sats[i].name);
                scene.remove(currentSat);
            }

            sats = [];
            particles = [];
            catCount = [0, 0, 0, 0, 0];
            satIndex = 0;
            yearTransDone = false;

            if(times){
                for(let i = 0; i < times.length; i++){
                    times[i].children[1].style.visibility = "hidden";
                }

                document.getElementById("1974").children[1].style.visibility = "visible";
            }

            console.log("start back");

            let yearsTrans = setInterval(function(){

                if(yearsAlpha > 0){
                    yearsAlpha -= 0.1;
                    document.getElementById('by-years').style.opacity = yearsAlpha;

                    homeTransDone = false;
                }else{
                    homeTransDone = true;
                }

                if(mode === 2){
                    if(camera.position.x > 0){
                        camera.position.x -= 1;
                        homeTransDone = false;

                    }else{
                        camera.position.x = 0;

                        homeTransDone = true;
                    }

                    if(earth.position.x > 0){
                        earth.position.x -= 2;
                        homeTransDone = false;

                    }else{
                        earth.position.x = 0;

                        homeTransDone = true;
                    }

                    if(yearsBgPos < 125){
                        yearsBgPos += 0.5;
                        document.body.style.backgroundPosition = yearsBgPos + "%";
                        homeTransDone = false;
                    }else{
                        homeTransDone = true;
                    }
                }else if(mode === 1){
                    if(camera.position.x < 0){
                        camera.position.x += 1;
                        homeTransDone = false;

                    }else{
                        camera.position.x = 0;

                        homeTransDone = true;
                    }

                    if(earth.position.x < 0){
                        earth.position.x += 2;
                        homeTransDone = false;

                    }else{
                        earth.position.x = 0;

                        homeTransDone = true;
                    }

                    if(yearsBgPos > 125){
                        yearsBgPos -= 0.5;
                        document.body.style.backgroundPosition = yearsBgPos + "%";
                        homeTransDone = false;
                    }else{
                        homeTransDone = true;
                    }
                }

                if(homeTransDone){
                    console.log("stop interval");
                    clearInterval(yearsTrans);
                    homeTransDone = false;
                    mode = 0;

                    let infoHeight = parseFloat(window.getComputedStyle(document.getElementById('info-panel')).height);
                    let infoTop = HEIGHT / 2 - infoHeight / 2;

                    document.getElementById('info-panel').style.top = infoTop + "px";


                    let showInfo = setInterval(function(){



                        if(infoOpacity < 1){
                            infoOpacity += 0.1;
                            document.getElementById('info-panel').style.opacity = infoOpacity;
                        }else{
                            clearInterval(showInfo);
                        }



                    }, 50);

                }


            }, 50);


        }

        let cardsTransDone = false;

        let addSat;

        function viewCards(){

            mode = 1;

            console.log("cards start back");

            clearInterval(timer);

            for(let i = 0 ; i < sats.length; i++){
                let currentSat = scene.getObjectByName(sats[i].name);
                scene.remove(currentSat);
            }

            sats = [];
            particles = [];
            catCount = [0, 0, 0, 0, 0];
            satIndex = 0;
            yearTransDone = false;

            if(times){
                for(let i = 0; i < times.length; i++){
                    times[i].children[1].style.visibility = "hidden";
                }

                document.getElementById("1974").children[1].style.visibility = "visible";
            }


            let yearsTrans = setInterval(function(){


                if(yearsAlpha > 0){
                    yearsAlpha -= 0.1;
                    document.getElementById('by-years').style.opacity = yearsAlpha;

                    cardsTransDone = false;
                }else{
                    cardsTransDone = true;
                }

                if(camera.position.x > -20){
                    camera.position.x -= 1;
                    cardsTransDone = false;

                }else{
                    camera.position.x = -20;

                    cardsTransDone = true;
                }

                if(earth.position.x > -60){
                    earth.position.x -= 2;
                    cardsTransDone = false;

                }else{
                    earth.position.x = -60;

                    cardsTransDone = true;
                }

                if(infoOpacity > 0){
                    infoOpacity -= 0.1;
                    document.getElementById('info-panel').style.opacity = infoOpacity;

                    cardsTransDone = false;
                }else{
                    cardsTransDone = true;
                    document.getElementById('info-panel').style.top = "100vh";

                }


                if(yearsBgPos < 145){
                    yearsBgPos += 0.5;
                    document.body.style.backgroundPosition = yearsBgPos + "%";
                    cardsTransDone = false;
                }else{
                    cardsTransDone = true;
                }



                if(cardsTransDone){
                    console.log("stop interval");
                    clearInterval(yearsTrans);
                    cardsTransDone = false;

                    document.getElementById('card').style.display = "block";

                    xorigin = -60;

                    let clickSatIndex = 0;

                    addSat = setInterval(function(){
                        createSat(clickSatIndex, Math.random() * -100, Math.random() * 100 - 50, 0, frameCount, true);

                        clickSatIndex++;
                        if(clickSatIndex > 418){
                            clearInterval(addSat);
                        }

                    }, 500);

                }


            }, 50);


        }

        let timer;
        let times;

        function satByYears(){

            mode = 2;

            clearInterval(addSat);

            document.getElementById('card').style.display = "none";

            for(let i = 0 ; i < sats.length; i++){
                let currentSat = scene.getObjectByName(sats[i].name);
                scene.remove(currentSat);
            }

            xorigin = 40;

            sats = [];
            particles = [];
            catCount = [0, 0, 0, 0, 0];
            satIndex = 0;

            // camera.position.x = 10;
            //  earth.position.x = 40;

            let trans = setInterval(function(){



                yearsAlpha += 0.01;
                document.getElementById('by-years').style.opacity = yearsAlpha;

                if(yearsBgPos > 105){
                    yearsBgPos -= 0.5;
                }
                document.body.style.backgroundPosition = yearsBgPos + "%";

                if(infoOpacity > 0){
                    infoOpacity -= 0.1;
                    document.getElementById('info-panel').style.opacity = infoOpacity;
                    yearTransDone = false;

                }else{
                    document.getElementById('info-panel').style.top = "100vh";

                    yearTransDone = true;

                }

                if(camera.position.x < 10){
                    camera.position.x += 0.1;
                    yearTransDone = false;

                }else{
                    yearTransDone = true;
                }

                if(earth.position.x < 40){
                    earth.position.x += 0.5;
                    yearTransDone = false;

                }else{
                    yearTransDone = true;
                }

                if(yearTransDone){
                    clearInterval(trans);

                    console.log("start sat movement");

                    document.getElementById('by-years').style.display = "block";

                    timer = setInterval(function(){

                        console.log(satIndex);

                        let currentYear = satdata[satIndex][1];
                        document.getElementById('year').innerHTML = currentYear;

                        if(document.getElementById(currentYear).children[1].style.visibility !== "visible"){
                            times = document.getElementById('timeline').children;

                            for(let i = 0; i < times.length; i++){
                                times[i].children[1].style.visibility = "hidden";
                            }

                            document.getElementById(currentYear).children[1].style.visibility = "visible";
                        }

                        let yearIndex = satYears.indexOf(currentYear);
                        let satY = 100 / 33 * yearIndex;

                        let categories = satdata[satIndex][8].split('/');

                        for(let i = 0; i < categories.length; i++){
                            let square = document.createElement('div');
                            square.style.width = squareWidth + "px";
                            square.style.height = textHeight + "px";
                            square.style.display = "inline-block";
                            square.className = "counter";

                            if(categories[i] === "Civil"){
                                square.style.background = "rgba(247, 194, 66, 0.8)";
                                catCount[0]++;
                            }else if(categories[i] === "Government"){
                                square.style.background = "rgba(224, 60, 138, 0.8)";
                                catCount[1]++;
                            }else if(categories[i] === "Commercial"){
                                square.style.background = "rgba(88, 178, 220, 0.8)";
                                catCount[2]++;
                            }else if(categories[i] === "Military"){
                                square.style.background = "rgba(144, 180, 75, 0.8)";
                                catCount[3]++;
                            }else{
                                square.style.background = "rgba(255, 255, 255, 0.8)";
                            }
                            document.getElementById(currentYear).appendChild(square);

                            createSat(sats.length - 1, -80, 50 - satY, 0, frameCount, false);
                        }

                        if(Math.random() < 0.2){
                            let square = document.createElement('div');
                            square.style.width = squareWidth + "px";
                            square.style.height = textHeight + "px";
                            square.style.display = "inline-block";
                            square.style.background = "rgba(255, 255, 255, 0.8)";

                            document.getElementById(currentYear).appendChild(square);

                            catCount[4]++;

                            createSat(sats.length - 1, -80, 50 - satY, 0, frameCount, false);
                        }


                        document.getElementById('civil').innerHTML = catCount[0];
                        document.getElementById('gov').innerHTML = catCount[1];
                        document.getElementById('com').innerHTML = catCount[2];
                        document.getElementById('mil').innerHTML = catCount[3];
                        document.getElementById('unknown').innerHTML = catCount[4];

                        satIndex++;

                        if(satIndex > satdata.length - 1){
                            clearInterval(timer);
                            console.log("done");
                        }


                    }, 500);
                }

            }, 10);

        }


        if (!Detector.webgl) Detector.addGetWebGLMessage();

        let selected = -1;

        let perlin = new ImprovedNoise();

        window.addEventListener('resize', onWindowResize, false);

        THREE.Object3D.prototype.rotateAroundWorldAxis = function() {
            var q1 = new THREE.Quaternion();
            return function ( point, axis, angle ) {
                q1.setFromAxisAngle( axis, angle );
                this.quaternion.multiplyQuaternions( q1, this.quaternion );
                this.position.sub( point );
                this.position.applyQuaternion( q1 );
                this.position.add( point );
                return this;
            }
        }();

        let WIDTH = window.innerWidth;
        let HEIGHT = window.innerHeight;
        let camera = new THREE.PerspectiveCamera(60, WIDTH / HEIGHT, 0.01, 1500);
        camera.position.z = 120;

        let renderer = new THREE.WebGLRenderer({
          canvas: document.querySelector('#webgl'),
          antialias: true,
          alpha: true
        });

        let sats = [];
        let particles = [];

        renderer.setSize(WIDTH, HEIGHT);
        renderer.autoClear = false;
        renderer.setClearColor(0x000000, 0.0);


        let controls = new THREE.OrbitControls(camera, renderer.domElement);
        controls.enableRotate = false;

        let scene = new THREE.Scene();
        let interaction = new THREE.Interaction(renderer, scene, camera);
        // scene.fog = new THREE.Fog(0x000000, 0, 500);

        let earthMaterial = new THREE.MeshPhongMaterial({});
        earthMaterial.map = THREE.ImageUtils.loadTexture('data/img/earthmap.jpg');

        let earth = new THREE.Mesh(
            new THREE.SphereGeometry(35, 32, 32),
            earthMaterial
        );


       scene.add(earth);

       let stars = new THREE.Object3D();
       scene.add(stars);

       let starMaterial = new THREE.MeshPhongMaterial({
           color: 0xffffff,
           shading: THREE.FlatShading
       });

        let starGeo = new THREE.TetrahedronGeometry(0.2, 0);


        for (let i = 0; i < 300; i++) {
            let mesh = new THREE.Mesh(starGeo, starMaterial);
            mesh.position.set(Math.random() - 0.5, Math.random() - 0.5, Math.random() - 0.5).normalize();
            mesh.position.multiplyScalar(50 + (Math.random() * 100));
            mesh.rotation.set(Math.random() * 2, Math.random() * 2, Math.random() * 2);
            stars.add(mesh);
        }


        // let hemlight = new THREE.HemisphereLight( 0xffffff, 0x000000, 1 );
        // scene.add( hemlight );

        function createSat(i, x, y, z, frame, addClick){
            particles.push(new Particle(x, y, z));

            let bsize = 0.5;

            if(addClick){
                bsize = 1.5;
            }

            let cube = new THREE.Mesh(
                new THREE.BoxGeometry(bsize, bsize, bsize),
                new THREE.MeshPhongMaterial({ color: 0xffffff })
            );
            cube.cursor = 'pointer';

            cube.position.x = x;
            cube.position.y = y;
            cube.position.z = z;

            cube.xOffset = THREE.Math.randFloat(0.001, 0.003);
            cube.yOffset = THREE.Math.randFloat(0.001, 0.003);

            cube.startFrame = frame;
            cube.endTransition = false;
            cube.alpha = 0;

            cube.name = 'sat-' + sats.length;

            sats.push(cube);
            scene.add(sats[sats.length - 1]);

            if(addClick){
                sats[i].on('mouseover', function(ev) {
                    sats[i].material.color.r = 0;
                    selected = i;
                    console.log(selected);
                    document.getElementById('card-img').src = "data/img/" + selected + ".png";
                });

                sats[i].on('mouseout', function(ev) {
                    sats[i].material.color.r = 1;
                });
            }

        }
        
        let ambient = new THREE.AmbientLight( 0x666666 );
        scene.add( ambient );

        let light = new THREE.PointLight(0xffffff);
        light.position.set(20, 50, 50);
        scene.add(light);

        // var lights = [];
        // lights[0] = new THREE.DirectionalLight( 0xffffff, 1 );
        // lights[0].position.set( 1, 0, 0 );
        // lights[1] = new THREE.DirectionalLight( 0x11E8BB, 1 );
        // lights[1].position.set( 0.75, 1, 0.5 );
        // lights[2] = new THREE.DirectionalLight( 0x8200C9, 1 );
        // lights[2].position.set( -0.75, -1, 0.5 );
        // scene.add( lights[0] );
        // scene.add( lights[1] );
        // scene.add( lights[2] );


        let frameCount = 0;
        let xorigin = 40;

        let clock = new THREE.Clock(true);

        function render() {

            earth.rotation.y = frameCount * 0.001;

            for (let i = 0; i < particles.length; i++) {
                let p = particles[i];

                let x = 40 * Math.cos((frameCount - sats[i].startFrame) * sats[i].xOffset) * Math.sin((frameCount - sats[i].startFrame) * sats[i].yOffset) + xorigin;
                let y = 40 * Math.sin((frameCount - sats[i].startFrame) * sats[i].xOffset) * Math.sin((frameCount - sats[i].startFrame) * sats[i].yOffset);
                let z = 40 * Math.cos((frameCount - sats[i].startFrame) * sats[i].yOffset);

                p.pos = new THREE.Vector3(x, y, z);
            }

            let delta = clock.getDelta();

            let currentX, currentY, currentZ;

        	for(let i = 0; i < sats.length; i++){

                if(!sats[i].endTransition){
        	        currentX = Math.abs(particles[i].pos.x - sats[i].position.x);
        	        currentY = Math.abs(particles[i].pos.y - sats[i].position.y);
        	        currentZ = Math.abs(particles[i].pos.z - sats[i].position.z);
                }
                else{
                    sats[i].position.x = particles[i].pos.x;
                    sats[i].position.y = particles[i].pos.y;
                    sats[i].position.z = particles[i].pos.z;
                }

                if (currentX >= 0.1 || currentY >= 0.1 || currentZ >= 0.1) {
                    sats[i].alpha += delta * 3;
                    sats[i].position.lerp(particles[i].pos, sats[i].alpha);
                } else {
                    sats[i].endTransition = true;
                }
        	}

            stars.rotation.x += 0.0000;
            stars.rotation.y -= 0.0040;
          
          renderer.render(scene, camera);
          requestAnimationFrame(render);
          frameCount++;
        }
        render();

        function onWindowResize() {
          camera.aspect = (window.innerWidth) / window.innerHeight;
          camera.updateProjectionMatrix();
          renderer.setSize(window.innerWidth, window.innerHeight);
        }



      </script>

    </body>

    </html>

